<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Transport Layer The transport layer provides for logical communication between application processes running on different hosts. This means that application processes can send messages to each other without worrying about the details of the underlying physical infrastructure."><title>Transport Layer</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://www.brendanang.dev//icon.png><link href=https://www.brendanang.dev/styles.c6adaa3b473914a38283f492dfdbcb76.min.css rel=stylesheet><link href=https://www.brendanang.dev/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://www.brendanang.dev/js/darkmode.f4d43c22d05773345705b5a308888af6.min.js></script>
<script src=https://www.brendanang.dev/js/util.fa8e74b4065b97e6980a72cc472e436f.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://www.brendanang.dev/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://www.brendanang.dev/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://www.brendanang.dev/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://www.brendanang.dev/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,PRODUCTION=!0,BASE_URL="https://www.brendanang.dev/",fetchData=Promise.all([fetch("https://www.brendanang.dev/indices/linkIndex.ecfa414e1282826cc43a2473116a81b9.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://www.brendanang.dev/indices/contentIndex.d49fde9522c188996a6772cce3033c34.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://www.brendanang.dev",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://www.brendanang.dev",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/www.brendanang.dev\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://www.brendanang.dev/js/full-text-search.51f0b1753e9b30839d053f8a98cc20d1.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://www.brendanang.dev/>Brendan Ang</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Transport Layer</h1><p class=meta>Last updated
Jan 20, 2023
<a href=https://github.com/bbawj/site/Notes/Transport%20Layer.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#multiplexing-and-demultiplexing>Multiplexing and Demultiplexing</a></li><li><a href=#transport-layer-protocols>Transport Layer Protocols</a><ol><li><a href=#udp>UDP</a></li><li><a href=#tcp>TCP</a></li></ol></li><li><a href=#principles-of-reliable-data-transfer>Principles of Reliable Data Transfer</a><ol><li><a href=#fundamentals>Fundamentals</a></li><li><a href=#pipelining>Pipelining</a></li></ol></li></ol></nav></details></aside><a href=#transport-layer><h1 id=transport-layer><span class=hanchor arialabel=Anchor># </span>Transport Layer</h1></a><p>The transport layer provides for <strong>logical communication between application processes running on different hosts</strong>. This means that application processes can send messages to each other without worrying about the details of the underlying physical infrastructure.</p><blockquote class=example-callout><p>12 kids in Ann’s house sending letters to 12 kids in Bill’s house. Ann and Bill are responsible for mail collection and distribution, and interfaces with the postal carrier.</p><ul><li>hosts = houses</li><li>processes = kids</li><li>app messages = letters in envelopes</li><li>transport protocol = Ann and Bill who demux to in-house siblings</li><li>network-layer protocol = postal service</li></ul></blockquote><a href=#multiplexing-and-demultiplexing><h2 id=multiplexing-and-demultiplexing><span class=hanchor arialabel=Anchor># </span>Multiplexing and Demultiplexing</h2></a><p>Multiplexing and demultiplexing is the extension of the host-to-host delivery service provided by the network layer to a process-to-process delivery service for applications running on the hosts.</p><p>A host can have multiple network processes running, and each can have 1 or more sockets for which data passes from the network.</p><ul><li>Multiplexing: gathering data chunks at the source from different sockets, encapsulating each chunk with header information and passing the segments to the network layer</li><li>Demultiplexing: delivering data in a transport layer segment to the correct socket. In UDP a 2-pair {source port, dest port} can uniquely identify the destination socket. In TCP, a 4-pair {source port, source IP, dest port, dest IP} identifies the destination socket.
<img src=https://i.imgur.com/USGmCjF.png width=auto alt></li></ul><a href=#transport-layer-protocols><h2 id=transport-layer-protocols><span class=hanchor arialabel=Anchor># </span>Transport Layer Protocols</h2></a><a href=#udp><h3 id=udp><span class=hanchor arialabel=Anchor># </span>UDP</h3></a><p>A barebones transport protocol for the Internet is
<a href=/Notes/User-Datagram-Protocol/ rel=noopener class=internal-link data-src=/Notes/User-Datagram-Protocol/>User Datagram Protocol</a></p><a href=#tcp><h3 id=tcp><span class=hanchor arialabel=Anchor># </span>TCP</h3></a><p><a href=/Notes/Transmission-Control-Protocol/ rel=noopener class=internal-link data-src=/Notes/Transmission-Control-Protocol/>Transmission Control Protocol</a> provides a reliable channel service to the applications which invoke it.</p><a href=#principles-of-reliable-data-transfer><h2 id=principles-of-reliable-data-transfer><span class=hanchor arialabel=Anchor># </span>Principles of Reliable Data Transfer</h2></a><p><img src=https://i.imgur.com/lcBKkXz.png width=auto alt></p><a href=#fundamentals><h3 id=fundamentals><span class=hanchor arialabel=Anchor># </span>Fundamentals</h3></a><p>We can incrementally build a reliable data transfer (rdt) protocol using <a href=/Notes/Finite-State-Machines rel=noopener class=internal-link data-src=/Notes/Finite-State-Machines>finite state machines</a></p><a href=#rdt-10-reliable-under-channel><h4 id=rdt-10-reliable-under-channel><span class=hanchor arialabel=Anchor># </span>RDT 1.0 reliable under channel</h4></a><p><img src=https://i.imgur.com/CXSayAv.png width=auto alt></p><a href=#rdt-20-error-checking><h4 id=rdt-20-error-checking><span class=hanchor arialabel=Anchor># </span>RDT 2.0 error checking</h4></a><p>Add error checking through checksum calculation, acknowledgements (ACKs) and negative acknowledgements (NAKs), and have the sender retransmit the corrupted sentence.
<img src=https://i.imgur.com/ULJ2VIw.png width=auto alt></p><a href=#rdt-21-ack-corruption><h4 id=rdt-21-ack-corruption><span class=hanchor arialabel=Anchor># </span>RDT 2.1 ACK corruption</h4></a><p><em>The fatal flaw in rdt 2.0 is that the ACK or NAK packets may in itself be corrupted. How should the protocol recover from such errors?</em> Here are some ideas:</p><ul><li>Keep adding more &ldquo;ACK&rdquo; types. Reply with &ldquo;What did you say?&rdquo;. This can continue infinitely</li><li>Add enough checksum bits to recover from bit errors</li><li>Retransmit packets if the sender receives a corrupted ACK or NAK. However, we won&rsquo;t be able to tell if its new data or a retransmission on the receiver side!
We can add a new field to the data packet called the <strong>sequence number</strong>. The receiver need only check this to determine whether or not the received packet is retransmission.</li><li>For a stop-and-wait protocol, a 1 bit number will allow the sender to tell: no change -> retransmission, change -> new packet.
Sender:
<img src=https://i.imgur.com/lfXGhV8.png width=auto alt>
Receiver:
<img src=https://i.imgur.com/pUKCgOO.png width=auto alt></li></ul><a href=#rdt-22-nak-less><h4 id=rdt-22-nak-less><span class=hanchor arialabel=Anchor># </span>RDT 2.2 NAK-less</h4></a><p>We can remove the need for NAKs by sending an ACK only for the last correctly received packet. If the sender receives 2 ACKs for the same packet, it knows that the following packet was not received correctly.
<img src=https://i.imgur.com/uWZ4eqn.png width=auto alt></p><a href=#rdt-30-lossy-channels><h4 id=rdt-30-lossy-channels><span class=hanchor arialabel=Anchor># </span>RDT 3.0 Lossy channels</h4></a><p>The data packet, along with ACKs can be lost. We need ways to detect the loss, and actions to take to recover from the loss.
Sender side recovery: Wait for some timeout delay to receive an ACK, else retransmit.</p><ol><li>Start a timer each time a packet is sent</li><li>Respond to a timer interrupt by retransmission. This introduces duplicate packets which are handled by RDT 2.2</li><li>Stop the timer
<img src=https://i.imgur.com/JmdbEgP.png width=auto alt></li></ol><p><img src=https://i.imgur.com/kz8htxG.png width=auto alt></p><a href=#pipelining><h3 id=pipelining><span class=hanchor arialabel=Anchor># </span>Pipelining</h3></a><p>RDT 3.0 has a big performance implication due to its stop-and-wait protocol.
<img src=https://i.imgur.com/JBrYwTi.png width=auto alt>
We can boost performance by allowing the sender to send multiple packets without waiting for an ACK.
<img src=https://i.imgur.com/HDtzlWY.png width=auto alt></p><ul><li>The range of sequence numbers must be increased as more in-transit unacknowledged packets are allowed</li><li>Need to buffer the packets which have transmitted but unacknowledged</li></ul><a href=#go-back-n-gbn><h4 id=go-back-n-gbn><span class=hanchor arialabel=Anchor># </span>Go-Back-N (GBN)</h4></a><p>We need a way to determine the range of sequence numbers needed. This depends on how error recovery is performed. Go-Back-N allows the sender to transmit multiple packets without waiting for ACK but this number is constrained to no more than some maximum N.
A <strong>sliding window</strong> protocol:
<img src=https://i.imgur.com/LJ0QadF.png width=auto alt></p><ul><li>[0, base-1] packets which are sent and acked</li><li>[base, nextseqnum-1] packets sent and not acked</li><li>[nextseqnum, base+N-1] packets that can be sent immediately should data arrive</li><li><blockquote><p>[base+n] cannot be used until a packet is acked
Sender:
<img src=https://i.imgur.com/Q0VL5tp.png width=auto alt></p></blockquote></li><li>The timer is for the oldest unacked packet. This is restarted when we get an ack for a new sequence number.</li><li>All packets in the window are retransmitted on timeout
Receiver:
<img src=https://i.imgur.com/qKzbKpQ.png width=auto alt></li><li>Out of order packets are discarded. By default, it will send ACK for the expected sequence number - 1 which it keeps track of internally.
<img src=https://i.imgur.com/ZyILnBG.png width=auto alt=500></li></ul></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/Notes/Network-Layer/ data-ctx="logical communication from the Transport Layer, which is within the host itself" data-src=/Notes/Network-Layer class=internal-link>Network Layer</a></li><li><a href=/Notes/Transmission-Control-Protocol/ data-ctx="RDT 3.0 Lossy channels" data-src=/Notes/Transmission-Control-Protocol class=internal-link>Transmission Control Protocol</a></li><li><a href=/Notes/User-Datagram-Protocol/ data-ctx="multiplexing/demultiplexing function" data-src=/Notes/User-Datagram-Protocol class=internal-link>User Datagram Protocol</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://www.brendanang.dev/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Brendan Ang using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://www.brendanang.dev/>Home</a></li><li><a href=https://github.com/bbawj>Github</a></li></ul></footer></div></div></body></html>