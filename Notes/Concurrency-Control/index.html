<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=description content="Concurrency Control The DBMS needs to ensure consistency during concurrent execution of transactions, as concurrency can result in the database being in an inconsistent state despite preserving the correctness of transactions and without encountering a failure."><title>Concurrency Control
</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://www.brendanang.dev//icon.png><link href=https://www.brendanang.dev/styles.c6adaa3b473914a38283f492dfdbcb76.min.css rel=stylesheet><link href=https://www.brendanang.dev/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://www.brendanang.dev/js/darkmode.f4d43c22d05773345705b5a308888af6.min.js></script><script src=https://www.brendanang.dev/js/util.fa8e74b4065b97e6980a72cc472e436f.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script><script type=module>
      import mermaid from 'https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script><script src=https://unpkg.com/@floating-ui/core@0.7.3></script><script src=https://unpkg.com/@floating-ui/dom@0.5.4></script><script src=https://www.brendanang.dev/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script><script src=https://www.brendanang.dev/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script><script src=https://www.brendanang.dev/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script><script src=https://www.brendanang.dev/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script><script>const SEARCH_ENABLED=!1,PRODUCTION=!0,BASE_URL="https://www.brendanang.dev/",fetchData=Promise.all([fetch("https://www.brendanang.dev/indices/linkIndex.84a6714a5001f23f619a6012b456b34d.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://www.brendanang.dev/indices/contentIndex.61de53cbb96862628149d53bfdffe9d4.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://www.brendanang.dev",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://www.brendanang.dev",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{"â€™":"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/www.brendanang.dev\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script><script defer src=https://www.brendanang.dev/js/full-text-search.51f0b1753e9b30839d053f8a98cc20d1.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://www.brendanang.dev/>Brendan Ang</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg>
</label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Concurrency Control</h1><p class=meta>Last updated
Nov 8, 2022
<a href=https://github.com/bbawj/site/Notes/Concurrency%20Control.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#scheduler>Scheduler</a><ol><li><a href=#serial-schedule>Serial schedule</a></li><li><a href=#serializable-schedule>Serializable schedule</a></li><li><a href=#conflict-serializable-schedule>Conflict Serializable Schedule</a></li><li><a href=#recoverable-schedule>Recoverable Schedule</a></li></ol></li><li><a href=#locks>Locks</a><ol><li><a href=#two-phase-locking-2pl>Two Phase Locking (2PL)</a></li><li><a href=#lock-mechanisms>Lock mechanisms</a></li><li><a href=#workings-of-scheduler>Workings of Scheduler</a></li></ol></li><li><a href=#deadlock-detection--prevention>Deadlock Detection & Prevention</a><ol><li><a href=#timeout>Timeout</a></li><li><a href=#waits-for-graph>Waits-For Graph</a></li><li><a href=#timestamps>Timestamps</a></li><li><a href=#comparison>Comparison</a></li></ol></li><li><a href=#timestamp-ordering>Timestamp Ordering</a><ol><li><a href=#rules>Rules</a></li><li><a href=#thomas-write-rule>Thomas Write Rule</a></li></ol></li><li><a href=#comparisons>Comparisons</a></li><li><a href=#multi-version-concurrency-control>Multi Version Concurrency Control</a><ol><li><a href=#concurrency-protocol>Concurrency Protocol</a></li><li><a href=#version-storage>Version Storage</a></li><li><a href=#garbage-collection>Garbage Collection</a></li></ol></li><li><a href=#practice-problems>Practice Problems</a></li></ol></nav></details></aside><a href=#concurrency-control><h1 id=concurrency-control><span class=hanchor arialabel=Anchor># </span>Concurrency Control</h1></a><p>The DBMS needs to ensure consistency during concurrent execution of transactions, as concurrency can result in the database being in an inconsistent state despite preserving the correctness of transactions and without encountering a failure.</p><a href=#scheduler><h2 id=scheduler><span class=hanchor arialabel=Anchor># </span>Scheduler</h2></a><p>A schedule is a sequence of interleaved actions from all transactions.</p><a href=#serial-schedule><h3 id=serial-schedule><span class=hanchor arialabel=Anchor># </span>Serial schedule</h3></a><p>A schedule is serial if its actions consists of all the actions of one transaction, then all the actions of another transaction, and so on.
<img src=https://i.imgur.com/1K60gAt.png width=auto alt=500></p><a href=#serializable-schedule><h3 id=serializable-schedule><span class=hanchor arialabel=Anchor># </span>Serializable schedule</h3></a><p>Result is equivalent to a serial schedule, but actions of one transaction do not have to occur before the actions of another.
<img src=https://i.imgur.com/EvCDCZb.png width=auto alt=500></p><a href=#conflict-serializable-schedule><h3 id=conflict-serializable-schedule><span class=hanchor arialabel=Anchor># </span>Conflict Serializable Schedule</h3></a><p><img src=https://i.imgur.com/sgLNvTW.png width=auto alt>
If a pair of actions conflict, if their order is interchanged, the behavior of at least one of the transactions can change.
From this we can draw 2 conclusions about when a pair can be swapped.</p><ol><li>Actions involve the same element</li><li>At least one is a write
<img src=https://i.imgur.com/hpD2zat.png width=auto alt></li></ol><a href=#precedence-graph><h4 id=precedence-graph><span class=hanchor arialabel=Anchor># </span>Precedence Graph</h4></a><p>We can use a precedence graph to determine if a set of transactions are conflict serializable. An edge from one node to another represents a constraint on the order of the transactions. i.e. Actions in a transaction t1 cannot be swapped with another transaction t2. If a cycle occurs, the order of transactions become contradictory and no serial schedule can exist.
<img src=https://i.imgur.com/01GqFEg.png width=auto alt></p><p><img src=https://i.imgur.com/PzNgNGH.png width=auto alt></p><p><img src=https://i.imgur.com/hqlUQN3.png width=auto alt></p><a href=#recoverable-schedule><h3 id=recoverable-schedule><span class=hanchor arialabel=Anchor># </span>Recoverable Schedule</h3></a><p>A schedule is recoverable if transactions commit only after all transactions whose changes they read have committed.
Else, the DBMS is unable to guarantee that transactions read data that will be the same as before the crash and after the crash.
<img src=https://i.imgur.com/mC9bKDu.png width=auto alt></p><a href=#locks><h2 id=locks><span class=hanchor arialabel=Anchor># </span>Locks</h2></a><p>Ensure that data items that are shared by conflicting operations are accessed one operation at a time. Same as with
<a href=/Notes/Process-Synchronization/ rel=noopener class=internal-link data-src=/Notes/Process-Synchronization/>Process Synchronization</a>.
<img src=https://i.imgur.com/0IiEBMH.png width=auto alt>
<img src=https://i.imgur.com/gHcnbL4.png width=auto alt></p><a href=#two-phase-locking-2pl><h3 id=two-phase-locking-2pl><span class=hanchor arialabel=Anchor># </span>Two Phase Locking (2PL)</h3></a><p>Arbitrary assignment of locks do not lead to a serializable schedule. Two transactions can operate on elements in a different order resulting in different results. We can solve this by ensuring that transactions take up all lock actions before all unlock actions.
<img src=https://i.imgur.com/IVf95ET.png width=auto alt></p><a href=#why-2pl-works><h4 id=why-2pl-works><span class=hanchor arialabel=Anchor># </span>Why 2PL works?</h4></a><p>Intuitively, each two-phase-locked transaction may be thought to execute in its entirety at the instant it issues its first unlock request. i.e. a legal schedule can only be such that the transaction completes fully, because otherwise, this means that another transaction is attempting to take a held lock, causing a deadlock. Hence, there is at least one conflict-serialisable schedule: the one in which the transactions appear in the same order as first unlocks.
<img src=https://i.imgur.com/4WIMEGr.png width=auto alt>
Suppose the schedule starts with T1 locking and reading <em>A</em>. If T2 locks <em>B</em> before T1 reaches its unlocking phase, then there is a deadlock, and the schedule cannot complete. Thus, if T1 performs an action first, it must perform <em>all</em> its actions before T2 performs any. Likewise, if T2 starts first, it must complete before T1 starts, or there is a deadlock. Thus, only the two serial schedules of these transactions are legal.</p><a href=#lock-mechanisms><h3 id=lock-mechanisms><span class=hanchor arialabel=Anchor># </span>Lock mechanisms</h3></a><a href=#shared-and-exclusive-locks><h4 id=shared-and-exclusive-locks><span class=hanchor arialabel=Anchor># </span>Shared and Exclusive locks</h4></a><ul><li>Shared lock: to allow for multiple transactions to perform <code>READ</code></li><li>Exclusive lock: for <code>WRITE</code>
<img src=https://i.imgur.com/ap4gy0W.png width=auto alt>
A transaction should only ask for an exclusive lock when it is ready to write, so that any read operations can still continue. Upgrade the lock when needed:
<img src=https://i.imgur.com/3uWyyJ9.png width=auto alt></li></ul><a href=#update-locks><h4 id=update-locks><span class=hanchor arialabel=Anchor># </span>Update locks</h4></a><p>Deadlocks can occur when transactions are unable to upgrade their shared locks to exclusive ones, since there are already shared locks taken. A separate lock type that may be later upgraded to an exclusive lock is needed.
<img src=https://i.imgur.com/5zCmLxd.png width=auto alt></p><a href=#compatibility-matrix><h4 id=compatibility-matrix><span class=hanchor arialabel=Anchor># </span>Compatibility matrix</h4></a><p><img src=https://i.imgur.com/NqG3L6i.png width=auto alt></p><a href=#workings-of-scheduler><h3 id=workings-of-scheduler><span class=hanchor arialabel=Anchor># </span>Workings of Scheduler</h3></a><p><img src=https://i.imgur.com/8zwE14N.png width=auto alt></p><ol><li>Part 1: Inserts appropriate lock actions ahead of all DB access operations and release the locks held by the Transaction when it aborts/commits</li><li>Part 2: maintains a waiting list of transactions that need to acquire locks</li></ol><a href=#deadlock-detection--prevention><h2 id=deadlock-detection--prevention><span class=hanchor arialabel=Anchor># </span>Deadlock Detection & Prevention</h2></a><a href=#timeout><h3 id=timeout><span class=hanchor arialabel=Anchor># </span>Timeout</h3></a><p>Place a limit on how long a transaction may be active, if it exceeds this time, it is forced to release its locks and other resources and roll back.</p><a href=#waits-for-graph><h3 id=waits-for-graph><span class=hanchor arialabel=Anchor># </span>Waits-For Graph</h3></a><p>Utilises the
<a href=/Notes/Deadlocks/ rel=noopener class=internal-link data-src=/Notes/Deadlocks/>cyclic properties of deadlocks</a> to detect them.</p><ul><li>Each transaction holding a lock or waiting for one is a node</li><li>An edge exists from T1 to T2 if there is some element A where:<ul><li>T2 holds a lock on A</li><li>T1 is waiting for lock on A</li><li>T1 cannot get the lock on A unless T2 releases it
<img src=https://i.imgur.com/4GcWNC7.png width=auto alt>
This graph can become very large ad analysing this graph for every action can take a long time.</li></ul></li></ul><a href=#timestamps><h3 id=timestamps><span class=hanchor arialabel=Anchor># </span>Timestamps</h3></a><p>Assign each transaction with a timestamp. This timestamp never changes for the transaction even if it is rolled back.</p><a href=#wait-die><h4 id=wait-die><span class=hanchor arialabel=Anchor># </span>Wait-Die</h4></a><p><img src=https://i.imgur.com/f1MbRut.png width=auto alt></p><a href=#wound-wait><h4 id=wound-wait><span class=hanchor arialabel=Anchor># </span>Wound-Wait</h4></a><p><img src=https://i.imgur.com/RLvfh5T.png width=auto alt></p><a href=#comparison><h3 id=comparison><span class=hanchor arialabel=Anchor># </span>Comparison</h3></a><p><img src=https://i.imgur.com/gslOHOC.png width=auto alt></p><a href=#timestamp-ordering><h2 id=timestamp-ordering><span class=hanchor arialabel=Anchor># </span>Timestamp Ordering</h2></a><p>An optimistic approach. Use the timestamps of transactions to determine the serialisability of transactions.</p><ul><li>Each transaction receives a unique timestamp TS(T).</li><li>If TS(Ti ) &lt; TS(Tj ), then the DBMS must ensure that the execution schedule is equivalent to a serial schedule where Ti appears before Tj .
<img src=https://i.imgur.com/aIy3ZQn.png width=auto alt></li></ul><a href=#rules><h3 id=rules><span class=hanchor arialabel=Anchor># </span>Rules</h3></a><p><img src=https://i.imgur.com/Gl6dz77.png width=auto alt></p><ul><li>A transaction wants to read, but the element has already been written to by another transaction
<img src=https://i.imgur.com/iOeaFDw.png width=auto alt></li><li>A transaction wants to write, but the element has already been read by another transaction or written by another transaction
<img src=https://i.imgur.com/ku6Zq5d.png width=auto alt></li></ul><a href=#thomas-write-rule><h3 id=thomas-write-rule><span class=hanchor arialabel=Anchor># </span>Thomas Write Rule</h3></a><p>When a transaction wants to write, and TS(T) &lt; WT(X), ignore the write and allow the transaction to continue without aborting.
<img src=https://i.imgur.com/jggXLS7.png width=auto alt></p><ul><li>Timestamp ordering creates conflict serialisable schedules when this rule is not used</li><li>Schedules are not recoverable as TO does not have any checks</li></ul><a href=#comparisons><h2 id=comparisons><span class=hanchor arialabel=Anchor># </span>Comparisons</h2></a><p><img src=https://i.imgur.com/OvQkJJm.png width=auto alt></p><a href=#multi-version-concurrency-control><h2 id=multi-version-concurrency-control><span class=hanchor arialabel=Anchor># </span>Multi Version Concurrency Control</h2></a><p>A misnomer as it is not actually a concurrency control protocol.
DBMS maintains multiple physical versions of a single object in the database:</p><ul><li>When transaction writes to an object, the DBMS creates a new version</li><li>When transaction reads an object, it reads the newest version that exists when the transaction started
Each user connected to the database sees aÂ <em>snapshot</em>Â of the database at a particular instant in time. Any changes made by a writer will not be seen by other users of the database until the changes have been completed, providing isolation
<img src=https://i.imgur.com/rxyuTCY.png width=auto alt>
<img src=https://i.imgur.com/hMcMZuF.png width=auto alt></li></ul><a href=#concurrency-protocol><h3 id=concurrency-protocol><span class=hanchor arialabel=Anchor># </span>Concurrency Protocol</h3></a><p>Able to use any concurrency protocol to underly its implementation. MVCC is simply another layer on top of these protocols to provide transactional memory.</p><a href=#version-storage><h3 id=version-storage><span class=hanchor arialabel=Anchor># </span>Version Storage</h3></a><p>DBMS creates a version chain per tuple, which allows it to find version that is visible to a particular transaction at runtime. There are indexes which point to the head of the chain.
Version ordering:</p><ul><li>Oldest to Newest: append new version at the end of chain -> the entire chain has to be traversed for look ups</li><li>Newest to Oldest: append new version at the head of the chain, update index pointers to the head for every new version</li></ul><a href=#append-only><h4 id=append-only><span class=hanchor arialabel=Anchor># </span>Append only</h4></a><p><img src=https://i.imgur.com/nkFmNRj.png width=auto alt></p><a href=#time-travel-storage><h4 id=time-travel-storage><span class=hanchor arialabel=Anchor># </span>Time travel storage</h4></a><p><img src=https://i.imgur.com/Ug9aDBy.png width=auto alt></p><a href=#delta-storage><h4 id=delta-storage><span class=hanchor arialabel=Anchor># </span>Delta storage</h4></a><p><img src=https://i.imgur.com/zU5zSIj.png width=auto alt></p><a href=#garbage-collection><h3 id=garbage-collection><span class=hanchor arialabel=Anchor># </span>Garbage Collection</h3></a><p><img src=https://i.imgur.com/vdwgroe.png width=auto alt>
<img src=https://i.imgur.com/cArxcjN.png width=auto alt></p><a href=#practice-problems><h2 id=practice-problems><span class=hanchor arialabel=Anchor># </span>Practice Problems</h2></a><p><img src=https://i.imgur.com/bg5zD3I.png width=auto alt>
<img src=https://i.imgur.com/d7wWbX9.png width=auto alt>
<img src=https://i.imgur.com/Wa44loe.png width=auto alt></p><div class=mermaid>graph LR;
T3 --> T2;
T1 --> T2;
T3 --> T1;</div><table><thead><tr><th>Time</th><th>T1</th><th>T2</th><th>T3</th></tr></thead><tbody><tr><td>t1</td><td></td><td></td><td>Read(A)</td></tr><tr><td>t2</td><td></td><td></td><td>Read(B)</td></tr><tr><td>t3</td><td>Read(A)</td><td></td><td></td></tr><tr><td>t4</td><td>Read(C)</td><td></td><td></td></tr><tr><td>t5</td><td>Write(A)</td><td></td><td></td></tr><tr><td>t6</td><td></td><td>Read(C)</td><td></td></tr><tr><td>t7</td><td></td><td>Read(B)</td><td></td></tr><tr><td>t8</td><td></td><td>Write(C)</td><td></td></tr><tr><td>t9</td><td></td><td>Write(B)</td><td></td></tr><tr><td><img src=https://i.imgur.com/IJx9TNc.png width=auto alt></td><td></td><td></td><td></td></tr><tr><td>In 2PL, all locks must be acquired by the transaction, operations are done and then all locks are released at once.</td><td></td><td></td><td></td></tr><tr><td>This is schedule is not consistent with 2PL.</td><td></td><td></td><td></td></tr><tr><td>T1 takes ul(B), xl(B), ul(D), xl(D). T2 reads and writes item B at step 6, this is not possible if T1 still has the exclusive lock on B. Hence, T1 must have released all locks by step 6. However, T1 still takes read and write actions on D at step 13,14.</td><td></td><td></td><td></td></tr><tr><td>The minimal set of actions to remove:</td><td></td><td></td><td></td></tr></tbody></table><ul><li>5</li><li>6
<img src=https://i.imgur.com/0KehkE6.png width=auto alt><table><thead><tr><th>Time</th><th>T1</th><th>T2</th></tr></thead><tbody><tr><td>1</td><td>Read(Savings)</td><td></td></tr><tr><td>2</td><td></td><td>Read(Checking)</td></tr><tr><td>3</td><td>Write(Checking)</td><td></td></tr><tr><td>4</td><td></td><td>Write(Savings)</td></tr><tr><td><img src=https://i.imgur.com/RPcVyJs.png width=auto alt></td><td></td><td></td></tr><tr><td>Time</td><td>T1</td><td>T2</td></tr><tr><td>&mdash;-</td><td>&mdash;&ndash;</td><td>&mdash;-</td></tr><tr><td>1</td><td>r1(x)</td><td></td></tr><tr><td>2</td><td></td><td>r(x)</td></tr><tr><td>3</td><td></td><td>w(x)</td></tr><tr><td>4</td><td>r(y)</td><td></td></tr><tr><td>5</td><td></td><td>r(y)</td></tr></tbody></table></li></ul></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/4031-Database-Systems/ data-ctx="Concurrency Control" data-src=/4031-Database-Systems class=internal-link>4031 Database Systems</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://www.brendanang.dev/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Brendan Ang using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2025</p><ul><li><a href=https://www.brendanang.dev/>Home</a></li><li><a href=https://github.com/bbawj>Github</a></li></ul></footer></div></div></body></html>