<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="File Systems File A file is an unstructured sequence of bytes. Each byte is individually addressable from the beginning of the file."><title>File Systems</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://bbawj.github.io/site//icon.png><link href=https://bbawj.github.io/site/styles.879a44c0d79909457a19389c424941d3.min.css rel=stylesheet><link href=https://bbawj.github.io/site/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://bbawj.github.io/site/js/darkmode.604858f0be6a961da2204cc761cc89c4.min.js></script>
<script src=https://bbawj.github.io/site/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://bbawj.github.io/site/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://bbawj.github.io/site/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://bbawj.github.io/site/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://bbawj.github.io/site/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://bbawj.github.io/site/",fetchData=Promise.all([fetch("https://bbawj.github.io/site/indices/linkIndex.1241006f5b9db5962ed115e58291fe8d.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://bbawj.github.io/site/indices/contentIndex.de49e8f3f248e2817bcecc172d3d4e37.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://bbawj.github.io/site",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://bbawj.github.io/site",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/bbawj.github.io\/site\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://bbawj.github.io/site/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://bbawj.github.io/site/>bbawj.io</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>File Systems</h1><p class=meta>Last updated
Nov 8, 2022
<a href=https://github.com/bbawj/site/Notes/File%20Systems.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://bbawj.github.io/site/tags/question/>Question</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#file>File</a><ol><li><a href=#file-access>File access</a></li><li><a href=#protection>Protection</a></li><li><a href=#data-structures>Data Structures</a></li><li><a href=#storage-allocation>Storage allocation</a></li></ol></li><li><a href=#directories>Directories</a><ol><li><a href=#structure>Structure</a></li><li><a href=#tree-structured>Tree Structured</a></li><li><a href=#acyclic-graph-directories>Acyclic Graph Directories</a></li></ol></li><li><a href=#disk-space-management>Disk Space Management</a><ol><li><a href=#managing-free-blocks>Managing Free Blocks</a></li></ol></li><li><a href=#practice-problems>Practice Problems</a></li></ol></nav></details></aside><a href=#file-systems><h1 id=file-systems><span class=hanchor arialabel=Anchor># </span>File Systems</h1></a><a href=#file><h2 id=file><span class=hanchor arialabel=Anchor># </span>File</h2></a><p>A file is an unstructured sequence of bytes. Each byte is individually addressable from the beginning of the file.</p><a href=#file-access><h3 id=file-access><span class=hanchor arialabel=Anchor># </span>File access</h3></a><ul><li>Sequential: information is processed from the beginning of the file one byte after the other</li><li>Direct access: bytes can be read in any order by referencing the byte number</li></ul><a href=#protection><h3 id=protection><span class=hanchor arialabel=Anchor># </span>Protection</h3></a><p><img src=https://i.imgur.com/9acuiz6.png width=auto alt></p><ul><li>Owner: Permissions used by the assigned owner of the file or directory</li><li>Group: Permissions used by members of the group that owns the file or directory</li><li>Other: Permissions used by all users other than the file owner, and members of the group that owns the file or the directory</li></ul><a href=#data-structures><h3 id=data-structures><span class=hanchor arialabel=Anchor># </span>Data Structures</h3></a><a href=#file-control-block><h4 id=file-control-block><span class=hanchor arialabel=Anchor># </span>File Control Block</h4></a><p><img src=https://i.imgur.com/xKpBYnL.png width=auto alt=400></p><a href=#open-file-table><h4 id=open-file-table><span class=hanchor arialabel=Anchor># </span>Open File Table</h4></a><p><code>open()</code> syscall:</p><ul><li>First searches the system wide OFT to see if it is being used by another process. If it is, per process open file table entry is created pointing to this.</li><li>If not, the directory structure is searched for the file. FCB is copied to the system wide OFT. Entry is made in per process OFT and a pointer to the entry is returned.
<img src=https://i.imgur.com/YG1FRQs.png width=auto alt>
The open file tables saves substantial overhead by serving as a cache for the FCB. Data blocks are <em>not</em> kept in memory, instead, when the process is closed, the FCB is entry is removed and the updated data is copied back to the disk.</li></ul><a href=#file-descriptor><h4 id=file-descriptor><span class=hanchor arialabel=Anchor># </span>File Descriptor</h4></a><p>A file descriptor is a non-negative integer which indexes into a per-process file descriptor table which is maintained by the kernel. This in turn indexes into a system-wide open file table. It also indexes into the inode table that describes the actual underlying files. All operations are done on the file descriptor</p><a href=#storage-allocation><h3 id=storage-allocation><span class=hanchor arialabel=Anchor># </span>Storage allocation</h3></a><p>File-Organisation Module: allocates storage space for files, translates logical block addresses to physical block addresses, and manages free disk space.</p><a href=#contiguous><h4 id=contiguous><span class=hanchor arialabel=Anchor># </span>Contiguous</h4></a><p>Each file occupies a set of contiguous blocks on the disk.
Advantages:</p><ul><li>Simple as only starting location and length is required</li><li>Supports random access
Disadvantages:</li><li>Finding a hole big enough may result in external fragmentation</li><li>File space is constricted by size of the hole, it might need to be moved to a bigger hole in the future</li><li>If file space is overestimated there will be internal fragmentation
<img src=https://i.imgur.com/YKfQr9s.png width=auto alt></li></ul><blockquote class="[! the delete operation]-callout"><p>[! The delete operation]
Deleting a data block stored with contiguous allocation requires shifting of the data blocks.
<em>e.g. Delete data block 5 in a file with 10 data blocks</em>:
i.e. Read block 6, write block 5 with data from block 6, read block 7 and write block 6 with block 7 etc.</p></blockquote><a href=#linked><h4 id=linked><span class=hanchor arialabel=Anchor># </span>Linked</h4></a><p>Each file is a linked list of disk blocks and the blocks may be scattered anywhere on the disk.
Advantages:</p><ul><li>Simple as only need starting address</li><li>No wasted space and no constraint on file size
Disadvantages:</li><li>No random access
<em>Assuming 4 bytes is reserved for the pointer to the next block:</em>
<img src=https://i.imgur.com/seAqKqD.png width=auto alt>
Why displacement need to + 4? #question i think maybe the first 4 bytes is used for the pointer, so displacement needs to +4 to skip the pointer address.</li></ul><blockquote class="[! the delete operation]-callout"><p>[! The delete operation]
Deleting a data block stored with linked allocation requires an update to the connected pointer.
<em>e.g. Delete data block 5 in a file with 10 data blocks</em>:
6 reads to reach block 5. 1 write to update the pointer of block 4 to block 6</p></blockquote><a href=#indexed-allocation><h4 id=indexed-allocation><span class=hanchor arialabel=Anchor># </span>Indexed allocation</h4></a><p>Each file has an index block which contains all pointers to the allocated blocks. Directory entry contains the block number of the index block. Similar to a
<a href=/site/Notes/Memory-Organisation/ rel=noopener class=internal-link data-src=/site/Notes/Memory-Organisation/>page table</a> for memory allocation.
Advantages:</p><ul><li>Supports random access</li><li>Dynamic storage allocation without external fragmentation
Disadvantages:</li><li>Overhead in keeping index blocks</li><li>Internal fragmentation as the last block that the index is pointing to may not be fully utilised
<img src=https://i.imgur.com/1sYk7IS.png width=auto alt></li></ul><blockquote class="[! the delete operation]-callout"><p>[! The delete operation]
Deleting a data block stored with indexed allocation requires an update to the indexed pointers.
<em>e.g. Delete data block 5 in a file with 10 data blocks</em>:
1 read for the index block, 4 writes to update pointers</p></blockquote><a href=#inode><h4 id=inode><span class=hanchor arialabel=Anchor># </span>inode</h4></a><p>An inode is an index block. For each file and directory there is an inode. The inode contains file attributes, 12 pointers to direct blocks (data blocks) and 3 pointers point to indirect blocks (index blocks) with 3 levels of indirection.
<img src=https://i.imgur.com/0t64Mny.png width=auto alt>
Indirection allows the system to support large file sizes:
<img src=https://i.imgur.com/zFuqkwv.png width=auto alt>
Using the inode:
<img src=https://i.imgur.com/XzcIDIN.png width=auto alt></p><a href=#directories><h2 id=directories><span class=hanchor arialabel=Anchor># </span>Directories</h2></a><a href=#structure><h3 id=structure><span class=hanchor arialabel=Anchor># </span>Structure</h3></a><p>A directory can be structured in two ways:</p><ol><li>each entry contains a file name and other attributes</li><li>each entry contains a file name and a pointer to another data structure where file attributes can be found
<img src=https://i.imgur.com/n5wb4w0.png width=auto alt></li></ol><p><img src=https://i.imgur.com/qw4qB6W.png width=auto alt></p><blockquote class="[!disk reads when navigating a directory]-callout"><p>[!Disk reads when navigating a directory]
Assume that root directory is in memory
Open(“/usr/ast/mbox”) will require 5 disk reads</p><ol><li>load inode of “usr”</li><li>load data block of “usr” (i.e., directory “usr”)</li><li>load inode for “ast”</li><li>load data block of “ast” (i.e., directory “ast”)</li><li>load inode for “mbox”</li></ol></blockquote><a href=#tree-structured><h3 id=tree-structured><span class=hanchor arialabel=Anchor># </span>Tree Structured</h3></a><p><img src=https://i.imgur.com/7FbJ3PU.png width=auto alt>
Path Name</p><ul><li>Absolute Path Name: begins at the root and follows a path down to the specific file, e.g., /spell/mail/prt/first</li><li>Relative Path Name: Defines a path from the current directory, e.g. current directory is: /spell/mail relative path name for the above file is: prt/first
Characteristics:</li><li>Efficient Searching: File can be easily located according to the path name.</li><li>Naming: Files can have the same name under different directories.</li><li>Grouping: files can be grouped logically according to their properties</li></ul><a href=#acyclic-graph-directories><h3 id=acyclic-graph-directories><span class=hanchor arialabel=Anchor># </span>Acyclic Graph Directories</h3></a><p>The tree structure prohibits sharing of files or directories while an acyclic graph allows this. It is a natural generalisation of the tree structure.</p><a href=#links-as-a-unix-implementation><h4 id=links-as-a-unix-implementation><span class=hanchor arialabel=Anchor># </span>Links as a UNIX implementation</h4></a><p>A link is a directory entry which is a poitner to another file or subdirectory
<img src=https://i.imgur.com/XBiK2Ib.png width=auto alt></p><ul><li>A hard link points to the data on storage, while a soft link can point to another link which points to information on storage.</li><li>Both linking strategies allow a separate file name to be used for the source file name. This source file name will resolve to the target file data by following the link.
<img src=https://i.imgur.com/1kMzyvA.png width=auto alt=500></li></ul><a href=#what-happens-on-deletion><h4 id=what-happens-on-deletion><span class=hanchor arialabel=Anchor># </span>What happens on deletion?</h4></a><p>One possibility is to remove the file whenever anyone deletes it, but this action may leave dangling pointers to the now-nonexistent file. Worse, if the remaining file pointers contain actual disk addresses, and the space is subsequently reused for other files, these dangling pointers may point into the middle of other files.
Soft links</p><ul><li>Search for liks and remove them: expensive unless a list of links is kept with the file OR</li><li>Leave the links and remove them only when trying to access them
Hard links</li><li>Preserve file unless all references are deleted. A count to the number of references is maintained in the file (a new link ++, deleting a link&ndash;).</li></ul><a href=#why-not-just-duplicate-the-file><h4 id=why-not-just-duplicate-the-file><span class=hanchor arialabel=Anchor># </span>Why not just duplicate the file?</h4></a><p>Duplicate directory entries make the original and the copy indistinguishable. A major problem with this is maintaining consistency when a file is modified</p><a href=#disk-space-management><h2 id=disk-space-management><span class=hanchor arialabel=Anchor># </span>Disk Space Management</h2></a><p>Block size affects both data rate and disk space utilisation</p><ul><li>Big block size: file fits into few blocks resulting in fast to find & transfer blocks, but wastes space if file does not occupy the entire last block</li><li>Small block size: file may consist of many blocks resulting in slow data rate
<img src=https://i.imgur.com/ozMKoK9.png width=auto alt></li></ul><a href=#managing-free-blocks><h3 id=managing-free-blocks><span class=hanchor arialabel=Anchor># </span>Managing Free Blocks</h3></a><p>There is a need to track which blocks are free in order to allocate disk space to files</p><a href=#bitmap><h4 id=bitmap><span class=hanchor arialabel=Anchor># </span>Bitmap</h4></a><p>Each block is represented by 1 bit, 1 (free) and 0 (allocated)
<img src=https://i.imgur.com/3T1eJaE.png width=auto alt>
Advantage:</p><ul><li>Simple and efficient to find the first free block via bit manipulation. i.e. Find the first non-0 word, and find the first bit 1 in the word.
Disadvantage:</li><li>Takes up additional space as each block requires 1 bit</li><li>Inefficient to look up this bitmap unless the entire map is kept in memory</li></ul><a href=#linked-list><h4 id=linked-list><span class=hanchor arialabel=Anchor># </span>Linked list</h4></a><p><img src=https://i.imgur.com/habWC4G.png width=auto alt>
The pointer to the next block is stored in the block itself, hence to read the entire list, each block must be read sequentially requiring substantial I/O time.</p><a href=#practice-problems><h2 id=practice-problems><span class=hanchor arialabel=Anchor># </span>Practice Problems</h2></a><p><img src=https://i.imgur.com/q4C26Gf.png width=auto alt>
a. False. Owner and the group which owner belongs to is able to read.
b. False. The OFT caches the FCB rather than the data block.
c. False. Using linked file allocation, any free data block can be used.
<img src=https://i.imgur.com/3BDfuQU.png width=auto alt>
a. The previous links will now point to the data of the new file. To avoid this, dangling links need to be cleaned up.
b.
Single copy</p><ul><li>Race conditions, mutual exclusion
Multiple copy</li><li>Storage waste</li><li>Inconsistency
<img src=https://i.imgur.com/VEuDidH.png width=auto alt>
a. 5 disk accesses</li></ul><ol><li>Load inode of usr</li><li>Load directory for usr</li><li>Load inode for ast</li><li>Load directory for ast</li><li>Load inode for mbox
b. Seek: no disk reads needed
Current position is 5900: Logical block 5, byte 900.
read(100): 1 disk read by following direct pointer
read(200): 2 disk read by following single indirect pointer
3 disk reads total
c.
Number of pointers in 1 index block = $1000/2=500$
File size supported = $(6+500) \times 1000=506,000B$
<img src=https://i.imgur.com/VB9xuM7.png width=auto alt>
File data can be stored across different physical storage blocks. A smaller physical block helps to reduce internal fragmentation as the last block occupied by the file can is only 512B compared to 4KB. Using the larger block size would also help to improve throughput.</li></ol></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/site/2005-Operating-Systems/ data-ctx="File Systems" data-src=/2005-Operating-Systems class=internal-link>2005 Operating Systems</a></li><li><a href=/site/Notes/Disk/ data-ctx data-src=/Notes/Disk class=internal-link>Disk</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://bbawj.github.io/site/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Brendan Ang using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=https://bbawj.github.io/site/>Home</a></li><li><a href=https://github.com/bbawj>Github</a></li></ul></footer></div></div></body></html>